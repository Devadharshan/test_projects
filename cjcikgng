---
- name: Deploy Samson to Windows servers
  hosts: all
  gather_facts: no

  vars:
    ansible_os_family: "Windows"

    # Jenkins-provided
    samson_version: "{{ SAMSON_VERSION }}"
    samson_artifactory_baseurl: "{{ ARTIFACTORY_URL }}"
    samson_artifactory_url: "{{ ARTIFACTORY_URL }}/samson/{{ SAMSON_VERSION }}"
    samson_archive_name: "samson-{{ samson_version }}"

    # Artifactory token aliases â€” make sure role finds it regardless of name used
    artl_api_token: "{{ ARTIFACTORY_KEY | default(artl_api_token | default('')) }}"
    arti_api_token:  "{{ ARTIFACTORY_KEY | default(arti_api_token  | default(artl_api_token | default(''))) }}"
    artifactory_api_token: "{{ ARTIFACTORY_KEY | default(artifactory_api_token | default(arti_api_token | default(''))) }}"
    artifactory_key: "{{ ARTIFACTORY_KEY | default(artifactory_key | default(artl_api_token | default(''))) }}"
    arti_token: "{{ ARTIFACTORY_KEY | default(arti_token | default(artifactory_key | default(''))) }}"

    # also pass the raw Jenkins value to a variable the role might expect
    artifactory_token_from_jenkins: "{{ ARTIFACTORY_KEY }}"

    # CyberArk certificate-based authentication (passed from Jenkins)
    cyberark_cert: "{{ cyberark_cert }}"
    cyberark_key: "{{ cyberark_key }}"
    cyberark_ca: "{{ cyberark_ca }}"

  roles:
    - ansible-role-samson




ansible-playbook \
  -i inventories/hosts.ini \
  playbooks/deploy_samson.yml \
  -e REGION="${REGION}" \
  -e ENVIRONMENT_TYPE="${ENVIRONMENT_TYPE}" \
  -e SAMSON_VERSION="${SAMSON_VERSION}" \
  -e ARTIFACTORY_KEY="${Artifactory_Key}" \
  -e arti_api_token="${Artifactory_Key}" \
  -e artl_api_token="${Artifactory_Key}" \
  -e artifactory_key="${Artifactory_Key}" \
  -e artifactory_api_token="${Artifactory_Key}" \
  -e cyberark_cert="${cyberarkCert}" \
  -e cyberark_key="${cyberarkKey}" \
  -e cyberark_ca="${cyberarkCA}"
