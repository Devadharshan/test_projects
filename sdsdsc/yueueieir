{
  "annotations": { "list": [] },
  "title": "BP Processing Trend Dashboard",
  "uid": "bp-processing-trend",
  "version": 1,
  "schemaVersion": 36,
  "style": "dark",
  "editable": true,
  "description": "High-level KPIs and trends for BP summary and non-summary metrics. Uses aggregated metrics pushed to Pushgateway.",
  "time": { "from": "now-7d", "to": "now" },
  "timepicker": {
    "refresh_intervals": ["5s","10s","30s","1m","5m","15m","30m","1h","6h","12h","24h"],
    "time_options": ["Today","Yesterday","7d","30d","90d","6M","1y"]
  },
  "templating": {
    "list": [
      {
        "name": "JobDetails",
        "type": "query",
        "label": "Job Details",
        "datasource": "prometheus",
        "query": "label_values(bp_summary_average_duration_seconds, job_details)",
        "refresh": 1,
        "includeAll": false,
        "multi": false
      },
      {
        "name": "BpName",
        "type": "query",
        "label": "BP Name",
        "datasource": "prometheus",
        "query": "label_values(bp_non_summary_duration_seconds, bp_name)",
        "refresh": 1,
        "includeAll": false,
        "multi": false
      },
      {
        "name": "ThreadID",
        "type": "query",
        "label": "Thread ID",
        "datasource": "prometheus",
        "query": "label_values(bp_non_summary_duration_seconds{bp_name=\"$BpName\"}, thread_id)",
        "refresh": 2,
        "includeAll": false,
        "multi": false
      }
    ]
  },
  "panels": [
    { "type": "row", "title": "SUMMARY — Comparison KPIs", "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 }, "id": 1 },

    { "type": "stat", "title": "Summary — Avg Duration (Today)", "datasource": "prometheus",
      "targets": [ { "expr": "avg(bp_summary_average_duration_seconds{job_details=\"$JobDetails\"})", "refId": "A" } ],
      "gridPos": { "h": 4, "w": 6, "x": 0, "y": 1 }, "id": 10 },

    { "type": "stat", "title": "Summary — Avg Duration (Yesterday avg)", "datasource": "prometheus",
      "targets": [ { "expr": "avg_over_time(bp_summary_average_duration_seconds{job_details=\"$JobDetails\"}[24h] offset 1d)", "refId": "A" } ],
      "gridPos": { "h": 4, "w": 6, "x": 6, "y": 1 }, "id": 11 },

    { "type": "stat", "title": "Summary — Avg Duration (Last 7d avg)", "datasource": "prometheus",
      "targets": [ { "expr": "avg_over_time(bp_summary_average_duration_seconds{job_details=\"$JobDetails\"}[7d])", "refId": "A" } ],
      "gridPos": { "h": 4, "w": 6, "x": 12, "y": 1 }, "id": 12 },

    { "type": "stat", "title": "Summary — Avg Duration (Last 30d avg)", "datasource": "prometheus",
      "targets": [ { "expr": "avg_over_time(bp_summary_average_duration_seconds{job_details=\"$JobDetails\"}[30d])", "refId": "A" } ],
      "gridPos": { "h": 4, "w": 6, "x": 18, "y": 1 }, "id": 13 },

    { "type": "stat", "title": "Summary — Total Trades (Today sum)", "datasource": "prometheus",
      "targets": [ { "expr": "sum(bp_summary_total_trades{job_details=\"$JobDetails\"})", "refId": "A" } ],
      "gridPos": { "h": 4, "w": 6, "x": 0, "y": 6 }, "id": 20 },

    { "type": "stat", "title": "Summary — Total Trades (Yesterday sum)", "datasource": "prometheus",
      "targets": [ { "expr": "sum_over_time(bp_summary_total_trades{job_details=\"$JobDetails\"}[24h] offset 1d)", "refId": "A" } ],
      "gridPos": { "h": 4, "w": 6, "x": 6, "y": 6 }, "id": 21 },

    { "type": "stat", "title": "Summary — Total Trades (Last 7d sum)", "datasource": "prometheus",
      "targets": [ { "expr": "sum_over_time(bp_summary_total_trades{job_details=\"$JobDetails\"}[7d])", "refId": "A" } ],
      "gridPos": { "h": 4, "w": 6, "x": 12, "y": 6 }, "id": 22 },

    { "type": "stat", "title": "Summary — Total Trades (Last 30d sum)", "datasource": "prometheus",
      "targets": [ { "expr": "sum_over_time(bp_summary_total_trades{job_details=\"$JobDetails\"}[30d])", "refId": "A" } ],
      "gridPos": { "h": 4, "w": 6, "x": 18, "y": 6 }, "id": 23 },

    { "type": "stat", "title": "Summary — Job Count (Today sum)", "datasource": "prometheus",
      "targets": [ { "expr": "sum(bp_summary_job_count{job_details=\"$JobDetails\"})", "refId": "A" } ],
      "gridPos": { "h": 4, "w": 6, "x": 0, "y": 11 }, "id": 30 },

    { "type": "stat", "title": "Summary — Job Count (Yesterday sum)", "datasource": "prometheus",
      "targets": [ { "expr": "sum_over_time(bp_summary_job_count{job_details=\"$JobDetails\"}[24h] offset 1d)", "refId": "A" } ],
      "gridPos": { "h": 4, "w": 6, "x": 6, "y": 11 }, "id": 31 },

    { "type": "stat", "title": "Summary — Job Count (Last 7d sum)", "datasource": "prometheus",
      "targets": [ { "expr": "sum_over_time(bp_summary_job_count{job_details=\"$JobDetails\"}[7d])", "refId": "A" } ],
      "gridPos": { "h": 4, "w": 6, "x": 12, "y": 11 }, "id": 32 },

    { "type": "stat", "title": "Summary — Job Count (Last 30d sum)", "datasource": "prometheus",
      "targets": [ { "expr": "sum_over_time(bp_summary_job_count{job_details=\"$JobDetails\"}[30d])", "refId": "A" } ],
      "gridPos": { "h": 4, "w": 6, "x": 18, "y": 11 }, "id": 33 },

    { "type": "row", "title": "SUMMARY — Trend Charts", "gridPos": { "h": 1, "w": 24, "x": 0, "y": 16 }, "id": 40 },

    { "type": "timeseries", "title": "Summary — Avg Duration (per day)", "datasource": "prometheus",
      "targets": [ { "expr": "bp_summary_average_duration_seconds{job_details=\"$JobDetails\"}", "refId": "A", "legendFormat": "{{file_date}}"} ],
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 17 }, "id": 41 },

    { "type": "timeseries", "title": "Summary — Total Trades (per day)", "datasource": "prometheus",
      "targets": [ { "expr": "bp_summary_total_trades{job_details=\"$JobDetails\"}", "refId": "A", "legendFormat": "{{file_date}}"} ],
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 17 }, "id": 42 },

    { "type": "row", "title": "NON-SUMMARY — Comparison KPIs", "gridPos": { "h": 1, "w": 24, "x": 0, "y": 26 }, "id": 50 },

    { "type": "stat", "title": "NonSummary — Avg Duration (Today)", "datasource": "prometheus",
      "targets": [ { "expr": "avg(bp_non_summary_duration_seconds{job_details=\"$JobDetails\", bp_name=\"$BpName\", thread_id=\"$ThreadID\"})", "refId": "A" } ],
      "gridPos": { "h": 4, "w": 6, "x": 0, "y": 27 }, "id": 60 },

    { "type": "stat", "title": "NonSummary — Avg Duration (Yesterday avg)", "datasource": "prometheus",
      "targets": [ { "expr": "avg_over_time(bp_non_summary_duration_seconds{job_details=\"$JobDetails\", bp_name=\"$BpName\", thread_id=\"$ThreadID\"}[24h] offset 1d)", "refId": "A" } ],
      "gridPos": { "h": 4, "w": 6, "x": 6, "y": 27 }, "id": 61 },

    { "type": "stat", "title": "NonSummary — Avg Duration (Last 7d avg)", "datasource": "prometheus",
      "targets": [ { "expr": "avg_over_time(bp_non_summary_duration_seconds{job_details=\"$JobDetails\", bp_name=\"$BpName\", thread_id=\"$ThreadID\"}[7d])", "refId": "A" } ],
      "gridPos": { "h": 4, "w": 6, "x": 12, "y": 27 }, "id": 62 },

    { "type": "stat", "title": "NonSummary — Avg Duration (Last 30d avg)", "datasource": "prometheus",
      "targets": [ { "expr": "avg_over_time(bp_non_summary_duration_seconds{job_details=\"$JobDetails\", bp_name=\"$BpName\", thread_id=\"$ThreadID\"}[30d])", "refId": "A" } ],
      "gridPos": { "h": 4, "w": 6, "x": 18, "y": 27 }, "id": 63 },

    { "type": "stat", "title": "NonSummary — Total Trades (Today sum)", "datasource": "prometheus",
      "targets": [ { "expr": "sum(bp_non_summary_no_of_trades{job_details=\"$JobDetails\", bp_name=\"$BpName\", thread_id=\"$ThreadID\"})", "refId": "A" } ],
      "gridPos": { "h": 4, "w": 6, "x": 0, "y": 32 }, "id": 70 },

    { "type": "stat", "title": "NonSummary — Total Trades (Yesterday sum)", "datasource": "prometheus",
      "targets": [ { "expr": "sum_over_time(bp_non_summary_no_of_trades{job_details=\"$JobDetails\", bp_name=\"$BpName\", thread_id=\"$ThreadID\"}[24h] offset 1d)", "refId": "A" } ],
      "gridPos": { "h": 4, "w": 6, "x": 6, "y": 32 }, "id": 71 },

    { "type": "stat", "title": "NonSummary — Total Trades (Last 7d sum)", "datasource": "prometheus",
      "targets": [ { "expr": "sum_over_time(bp_non_summary_no_of_trades{job_details=\"$JobDetails\", bp_name=\"$BpName\", thread_id=\"$ThreadID\"}[7d])", "refId": "A" } ],
      "gridPos": { "h": 4, "w": 6, "x": 12, "y": 32 }, "id": 72 },

    { "type": "stat", "title": "NonSummary — Total Trades (Last 30d sum)", "datasource": "prometheus",
      "targets": [ { "expr": "sum_over_time(bp_non_summary_no_of_trades{job_details=\"$JobDetails\", bp_name=\"$BpName\", thread_id=\"$ThreadID\"}[30d])", "refId": "A" } ],
      "gridPos": { "h": 4, "w": 6, "x": 18, "y": 32 }, "id": 73 },

    { "type": "timeseries", "title": "NonSummary — Duration Trend", "datasource": "prometheus",
      "targets": [ { "expr": "bp_non_summary_duration_seconds{job_details=\"$JobDetails\", bp_name=\"$BpName\", thread_id=\"$ThreadID\"}", "refId": "A", "legendFormat": "{{file_date}}"} ],
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 37 }, "id": 80 },

    { "type": "timeseries", "title": "NonSummary — Trades Trend", "datasource": "prometheus",
      "targets": [ { "expr": "bp_non_summary_no_of_trades{job_details=\"$JobDetails\", bp_name=\"$BpName\", thread_id=\"$ThreadID\"}", "refId": "A", "legendFormat": "{{file_date}}"} ],
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 37 }, "id": 81 }

  ]
}